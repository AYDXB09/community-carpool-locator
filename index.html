<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Community Carpool – Location Picker</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      max-width: 520px;
      margin: auto;
    }

    h2 {
      margin-bottom: 20px;
    }

    gmp-place-autocomplete {
      display: block;
      width: 100%;
      margin-bottom: 14px;
      --gmp-place-autocomplete-input-padding: 12px;
      --gmp-place-autocomplete-input-font-size: 16px;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #256428;
    }

    .helper {
      font-size: 13px;
      color: #555;
      margin-bottom: 16px;
    }
  </style>
</head>

<body>

  <h2>Choose Your Route</h2>

  <!-- FROM -->
  <gmp-place-autocomplete
    id="fromInput"
    placeholder="From: community, school, office, or landmark (Dubai)"
  ></gmp-place-autocomplete>

  <div class="helper">
    Example: Saheel 2, Dwight School Dubai, Mall of the Emirates
  </div>

  <!-- TO -->
  <gmp-place-autocomplete
    id="toInput"
    placeholder="To: destination community, school, or landmark"
  ></gmp-place-autocomplete>

  <div class="helper">
    Tip: select from suggestions — typing alone won’t work
  </div>

  <button id="continueBtn">Continue</button>

  <!-- LOGIC -->
  <script>
    let fromPlace = null;
    let toPlace = null;

    async function initAutocomplete() {
      const fromEl = document.getElementById("fromInput");
      const toEl = document.getElementById("toInput");

      // UAE-only bias
      fromEl.componentRestrictions = { country: "ae" };
      toEl.componentRestrictions = { country: "ae" };

      fromEl.addEventListener("gmp-placeselect", (event) => {
        fromPlace = event.place;
      });

      toEl.addEventListener("gmp-placeselect", (event) => {
        toPlace = event.place;
      });
    }

    document.getElementById("continueBtn").addEventListener("click", async () => {
      if (!fromPlace || !toPlace) {
        alert("Please select both locations from the dropdown suggestions.");
        return;
      }

      // Fetch required fields
      await fromPlace.fetchFields({
        fields: ["formattedAddress", "location"]
      });

      await toPlace.fetchFields({
        fields: ["formattedAddress", "location"]
      });

      const fromLat = fromPlace.location.lat;
      const fromLng = fromPlace.location.lng;
      const toLat = toPlace.location.lat;
      const toLng = toPlace.location.lng;

      const tallyUrl =
        "https://tally.so/r/eqDG0e" +
        `?FromLocation=${encodeURIComponent(fromPlace.formattedAddress)}` +
        `&FromLatLng=${fromLat},${fromLng}` +
        `&ToLocation=${encodeURIComponent(toPlace.formattedAddress)}` +
        `&ToLatLng=${toLat},${toLng}`;

      window.location.href = tallyUrl;
    });
  </script>

  <!-- GOOGLE MAPS -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARzmbbhT0ki5-bZ-43pkkPyJNmOCTz4P0&libraries=places&v=beta&callback=initAutocomplete"
    async
    defer
  ></script>

</body>
</html>
