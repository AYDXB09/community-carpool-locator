<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Community Carpool – Location Picker</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 32px;
      max-width: 520px;
      margin: auto;
    }

    h2 {
      margin-bottom: 24px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 18px;
    }

    .helper {
      font-size: 13px;
      color: #555;
      margin: 6px 0 12px;
    }

    gmp-place-autocomplete {
      display: block;
      width: 100%;
      --gmp-place-autocomplete-input-padding: 12px;
      --gmp-place-autocomplete-input-font-size: 16px;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      margin-top: 24px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      opacity: 0.5;
    }

    button.enabled {
      opacity: 1;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <h2>Select Your Locations</h2>

  <!-- FROM -->
  <label>From (Starting location)</label>
  <div class="helper">
    Start typing and <strong>select from the dropdown</strong>.<br>
    Works best with schools, communities, offices, or landmarks.<br>
    <em>Examples: Saheel 2, Dwight School Dubai, Business Bay Metro</em>
  </div>

  <gmp-place-autocomplete
    id="fromInput"
    placeholder="Search and select starting location"
  ></gmp-place-autocomplete>

  <!-- TO -->
  <label>To (Destination)</label>
  <div class="helper">
    Again, <strong>you must click a suggestion</strong> — typing alone is not enough.
  </div>

  <gmp-place-autocomplete
    id="toInput"
    placeholder="Search and select destination"
  ></gmp-place-autocomplete>

  <button id="continueBtn">Continue</button>

  <script>
    let fromPlace = null;
    let toPlace = null;

    function updateButtonState() {
      const btn = document.getElementById("continueBtn");
      if (fromPlace && toPlace) {
        btn.classList.add("enabled");
      } else {
        btn.classList.remove("enabled");
      }
    }

    async function initAutocomplete() {
      const fromEl = document.getElementById("fromInput");
      const toEl = document.getElementById("toInput");

      // Bias for UAE
      fromEl.componentRestrictions = { country: "ae" };
      toEl.componentRestrictions = { country: "ae" };

      // Bias toward POIs + addresses
      fromEl.types = ["establishment", "geocode"];
      toEl.types = ["establishment", "geocode"];

      fromEl.addEventListener("gmp-placeselect", (e) => {
        fromPlace = e.place;
        updateButtonState();
      });

      toEl.addEventListener("gmp-placeselect", (e) => {
        toPlace = e.place;
        updateButtonState();
      });
    }

    document.getElementById("continueBtn").addEventListener("click", async () => {
      if (!fromPlace || !toPlace) {
        alert("Please select both locations from the dropdown suggestions.");
        return;
      }

      await fromPlace.fetchFields({ fields: ["formattedAddress", "location"] });
      await toPlace.fetchFields({ fields: ["formattedAddress", "location"] });

      const fromLatLng = `${fromPlace.location.lat},${fromPlace.location.lng}`;
      const toLatLng = `${toPlace.location.lat},${toPlace.location.lng}`;

      const tallyUrl =
        "https://tally.so/r/eqDG0e" +
        `?FromLocation=${encodeURIComponent(fromPlace.formattedAddress)}` +
        `&FromLatLng=${fromLatLng}` +
        `&ToLocation=${encodeURIComponent(toPlace.formattedAddress)}` +
        `&ToLatLng=${toLatLng}`;

      window.location.href = tallyUrl;
    });
  </script>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARzmbbhT0ki5-bZ-43pkkPyJNmOCTz4P0&libraries=places&v=beta&callback=initAutocomplete"
    async
    defer
  ></script>

</body>
</html>
